<!--
  git push originPages master
-->
<html><head>
  <meta name="viewport" content="width=device-width">
  <title>Car - Planck.js</title>
</head><body style="background-color: #333">
<script src="planck.js"></script>
<script src="marble.js"></script>
<script src="terrain.js"></script>
<script src="painter.js"></script>
<canvas id="canvas" width="800" height="600" style="border:1px solid #d3d3d3;">Your browser does not support the HTML5 canvas tag.</canvas></body></html>
<script>
var pl = planck, Vec2 = pl.Vec2;
var world = new pl.World({
  gravity : Vec2(0, -10)
});

var ANGULAR_SPEED = 2.5;
var AIR_SPEED = 2;

//terrain
createTerrain(world);

// marble
var marbleFD = {};
marbleFD.density = 2.0;
marbleFD.friction = .2;
var marble = Marble;

marble.m_marbleBody = world.createDynamicBody(Vec2(12.0, 1.0));
marble.m_marbleBody.setAngularDamping(.8);
marble.m_marbleBody.createFixture(pl.Circle(0.4), marbleFD);

world.on('begin-contact', function(contact) {
  marble.m_contactCount++;
});
world.on('end-contact', function(contact) {
  marble.m_contactCount--;
});
//input
var keys = []
window.addEventListener("keydown", function(e) {
  keys[e.keyCode] = true;
}, false);
window.addEventListener('keyup', function(e) {
  keys[e.keyCode] = false;
}, false);

//drawing
var canvas = document.getElementById("canvas");
var painter = new Painter(canvas.getContext("2d"), canvas.width, canvas.height);

function gameLoop() {  
  if (keys[39]) { //right
    marble.applyAngularForce(-ANGULAR_SPEED);
    if (!marble.isTouchingGround()) marble.applyLinearForce(Vec2(AIR_SPEED, 0));
  }
  else if (keys[37]) {
    marble.applyAngularForce(ANGULAR_SPEED);
    if (!marble.isTouchingGround()) marble.applyLinearForce(Vec2(-AIR_SPEED, 0));
  } 

  if (keys[38] && marble.isTouchingGround()) {
    marble.jump();        
  }

  world.step(1/60);
  painter.draw(world);
};

setInterval(gameLoop, 1000 / 60);
    
</script>